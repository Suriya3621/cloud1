{"ast":null,"code":"var _jsxFileName = \"/data/data/com.termux/files/home/cloud1/src/Components/Layout/SubComponent/Upload.jsx\";\nimport React, { useState } from 'react';\nimport axios from 'axios';\nimport { ref, uploadBytes, getDownloadURL } from 'firebase/storage';\nimport { storage } from '../../../App/Firebase.js';\nimport { useSelector } from 'react-redux';\nfunction Upload({\n  handleUploadBox,\n  reload\n}) {\n  const userData = useSelector(state => state.user.value);\n  const [file, setFile] = useState(null);\n  const [nickname, setNickname] = useState('');\n  const [uploading, setUploading] = useState(false);\n  const [message, setMessage] = useState('');\n  const [popupVisible, setPopupVisible] = useState(false);\n  const backendUrl = process.env.REACT_APP_BACKEND_URL;\n  const handleFileChange = event => {\n    setFile(event.target.files[0]);\n  };\n  const handleUpload = async () => {\n    if (!file) {\n      alert('Please choose a file first!');\n      return;\n    }\n    if (!nickname.trim()) {\n      alert('Please provide a nickname!');\n      return;\n    }\n    setUploading(true);\n    handleUploadBox(false, true); // Hide upload box and show loading popup\n\n    const fileRef = ref(storage, `uploads/${userData.name}/${Date.now()}_${file.name}`);\n    try {\n      await uploadBytes(fileRef, file);\n      const downloadURL = await getDownloadURL(fileRef);\n      const formatFileSize = sizeInBytes => {\n        if (sizeInBytes === 0) return '0 Bytes';\n        const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];\n        const i = Math.floor(Math.log(sizeInBytes) / Math.log(1024));\n        return (sizeInBytes / Math.pow(1024, i)).toFixed(2) + ' ' + sizes[i];\n      };\n      const fileData = {\n        username: userData.name.trim(),\n        name: nickname.trim() || file.name,\n        url: downloadURL,\n        fileSize: formatFileSize(file.size)\n      };\n      await axios.post(`${backendUrl}/file/uploadFile`, fileData);\n      setMessage('File uploaded successfully!');\n      setFile(null);\n      setNickname('');\n      reload();\n    } catch (error) {\n      console.error('Error uploading file:', error);\n      setMessage('Failed to upload file, please try again.');\n    } finally {\n      setUploading(false);\n      handleUploadBox(false, false); // Hide loading popup\n    }\n  };\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"space-y-4\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 69,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    className: \"block text-sm font-medium\",\n    htmlFor: \"upload-text\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 71,\n      columnNumber: 9\n    }\n  }, \"File Nickname\"), /*#__PURE__*/React.createElement(\"input\", {\n    type: \"text\",\n    id: \"upload-text\",\n    value: nickname,\n    onChange: e => setNickname(e.target.value),\n    className: \"mt-1 dark:text-black block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm\",\n    placeholder: \"Enter a nickname...\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    className: \"block text-sm font-medium\",\n    htmlFor: \"upload-file\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 9\n    }\n  }, \"Choose File\"), /*#__PURE__*/React.createElement(\"input\", {\n    type: \"file\",\n    id: \"upload-file\",\n    onChange: handleFileChange,\n    className: \"mt-1 block w-full text-sm text-gray-900 bg-gray-50 rounded-md border border-gray-300 cursor-pointer focus:outline-none\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: handleUpload,\n    className: \"w-full px-4 py-2 bg-blue-500 text-white font-medium rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\",\n    disabled: uploading,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 7\n    }\n  }, uploading ? 'Uploading...' : 'Upload'), message && /*#__PURE__*/React.createElement(\"p\", {\n    className: \"text-sm mt-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 19\n    }\n  }, message), popupVisible && /*#__PURE__*/React.createElement(\"div\", {\n    className: \"fixed bottom-4 right-4 p-4 bg-gray-800 text-white rounded-md shadow-lg flex items-center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"loading-spinner mr-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 11\n    }\n  }, \"Uploading...\")));\n}\nexport default Upload;","map":{"version":3,"names":["React","useState","axios","ref","uploadBytes","getDownloadURL","storage","useSelector","Upload","handleUploadBox","reload","userData","state","user","value","file","setFile","nickname","setNickname","uploading","setUploading","message","setMessage","popupVisible","setPopupVisible","backendUrl","process","env","REACT_APP_BACKEND_URL","handleFileChange","event","target","files","handleUpload","alert","trim","fileRef","name","Date","now","downloadURL","formatFileSize","sizeInBytes","sizes","i","Math","floor","log","pow","toFixed","fileData","username","url","fileSize","size","post","error","console","createElement","className","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","htmlFor","type","id","onChange","e","placeholder","onClick","disabled"],"sources":["/data/data/com.termux/files/home/cloud1/src/Components/Layout/SubComponent/Upload.jsx"],"sourcesContent":["import React, { useState } from 'react';\nimport axios from 'axios';\nimport { ref, uploadBytes, getDownloadURL } from 'firebase/storage';\nimport { storage } from '../../../App/Firebase.js';\nimport { useSelector } from 'react-redux';\n\nfunction Upload({ handleUploadBox, reload }) {\n  const userData = useSelector((state) => state.user.value);\n  const [file, setFile] = useState(null);\n  const [nickname, setNickname] = useState('');\n  const [uploading, setUploading] = useState(false);\n  const [message, setMessage] = useState('');\n  const [popupVisible, setPopupVisible] = useState(false);\n\n  const backendUrl = process.env.REACT_APP_BACKEND_URL;\n\n  const handleFileChange = (event) => {\n    setFile(event.target.files[0]);\n  };\n\n  const handleUpload = async () => {\n    if (!file) {\n      alert('Please choose a file first!');\n      return;\n    }\n\n    if (!nickname.trim()) {\n      alert('Please provide a nickname!');\n      return;\n    }\n\n    setUploading(true);\n    handleUploadBox(false, true); // Hide upload box and show loading popup\n\n    const fileRef = ref(storage, `uploads/${userData.name}/${Date.now()}_${file.name}`);\n    try {\n      await uploadBytes(fileRef, file);\n      const downloadURL = await getDownloadURL(fileRef);\n\n      const formatFileSize = (sizeInBytes) => {\n        if (sizeInBytes === 0) return '0 Bytes';\n        const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];\n        const i = Math.floor(Math.log(sizeInBytes) / Math.log(1024));\n        return (sizeInBytes / Math.pow(1024, i)).toFixed(2) + ' ' + sizes[i];\n      };\n\n      const fileData = {\n        username: userData.name.trim(),\n        name: nickname.trim() || file.name,\n        url: downloadURL,\n        fileSize: formatFileSize(file.size),\n      };\n\n      await axios.post(`${backendUrl}/file/uploadFile`, fileData);\n      setMessage('File uploaded successfully!');\n      setFile(null);\n      setNickname('');\n      reload();\n    } catch (error) {\n      console.error('Error uploading file:', error);\n      setMessage('Failed to upload file, please try again.');\n    } finally {\n      setUploading(false);\n      handleUploadBox(false, false); // Hide loading popup\n    }\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div>\n        <label className=\"block text-sm font-medium\" htmlFor=\"upload-text\">\n          File Nickname\n        </label>\n        <input\n          type=\"text\"\n          id=\"upload-text\"\n          value={nickname}\n          onChange={(e) => setNickname(e.target.value)}\n          className=\"mt-1 dark:text-black block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm\"\n          placeholder=\"Enter a nickname...\"\n        />\n      </div>\n      <div>\n        <label className=\"block text-sm font-medium\" htmlFor=\"upload-file\">\n          Choose File\n        </label>\n        <input\n          type=\"file\"\n          id=\"upload-file\"\n          onChange={handleFileChange}\n          className=\"mt-1 block w-full text-sm text-gray-900 bg-gray-50 rounded-md border border-gray-300 cursor-pointer focus:outline-none\"\n        />\n      </div>\n      <button\n        onClick={handleUpload}\n        className=\"w-full px-4 py-2 bg-blue-500 text-white font-medium rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\"\n        disabled={uploading}\n      >\n        {uploading ? 'Uploading...' : 'Upload'}\n      </button>\n      {message && <p className=\"text-sm mt-2\">{message}</p>}\n      {popupVisible && (\n        <div className=\"fixed bottom-4 right-4 p-4 bg-gray-800 text-white rounded-md shadow-lg flex items-center\">\n          <div className=\"loading-spinner mr-2\"></div>\n          <p>Uploading...</p>\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default Upload;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}